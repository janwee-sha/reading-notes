### 3.1.4 Volatile 变量

Java语言提供了一种稍弱的同步机制，即 `volatile` 变量，用来确保将变量的更新操作通知到其他线程。当把变量声明为 `volatile` 类型后，编译器与运行时都会注意到这个变量是共享的，因此不会将该变量上的操作与其他内存一起重排序。`volatile` 变量不会被缓存在寄存器或者对其他处理器不可见的地方，因此读取 `volatile` 类型的变量时总会返回最新写入的值。

`volatile` 变量对可见性的影响比 `volatile` 变量本身更为重要。当线程A首先写入一个 `volatile` 变量且线程B随后读取该变量时，在写入 `volatile` 变量之前对A可见的所有变量的值，在B读取了 `volatile` 变量后，对B也是可见的。从内存可见性的角度来看，写入 `volatile` 变量相当于退出同步代码块，而读取 `volatile` 变量就相当于进入同步代码块。

`volatile` 变量的正确使用方式包括：

- 确保它们自身状态的可见性；
- 确保它们所引用对象的状态的可见性；
- 标识一些重要的程序生命周期事件的发生（例如，初始化或关闭）。

