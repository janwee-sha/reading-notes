## 1.1 什么是微服务

微服务是一个小的、松耦合的分布式服务。
微服务架构具有以下特征：
- 应用程序逻辑分解为具有明确定义了职责范围的细粒度组件，这些组件互相协调提供解决方案。
- 各组件都有一个小的职责领域，且完全独立部署。微服务应该对业务领域的单个领域部分赋值。此外，一个微服务应跨多个应用程序复用。
- 微服务通信基于一些基本（非标准）的原则，并采用HTTP和JSON这样的轻量级通信协议，在服务消费者和服务提供者之间进行数据交换。
- 服务技术实现并没有什么影响，因为应用程序始终是哟个技术中立的协议进行通信。
- 微服务利用其小、独立和分布式的性质，使组织拥有明确责任领域的小型开发团队。

## 1.2 Spring为什么与微服务相关

Spring已成为Java应用成都事实上的标准开发框架。Spring的核心是建立在依赖注入的概念之上的。
Spring能够快速引入的特点推动了它的实际应用，成为替代J2EE的一个轻量级方案。
Spring Boot是对Spring框架理念重新思考的结果。包含了Spring的核心特性，提供了一个基于Java的、面向REST的微服务框架。只需一些简单的注解，Java开发者就能快速构建一个可打包和部署的REST微服务，这个微服务并不需要外部的应用容器。
在构建基于云的应用时，微服务已经成为更常见的架构模式之一，因此Spring社区为开发者提供了Spring Cloud。

## 1.5 使用Spring Boot来构建微服务

Spring Boot抽象出了常见的REST微服务任务：路由到业务逻辑、从URL中解析HTTP参数、JSON与对象相互映射等。

## 1.7 云到底是什么

云计算有3种基本模式：
- 基础设施即服务（Infrastructure as a Service，IaaS）；
- 平台即服务（Platform as a Service，PaaS）；
- 软件即服务（Software as a Service，SaaS）。

## 1.9 微服务不只是编写代码

微服务有6类模式：

- 核心微服务模式
- 微服务路由模式
- 微服务客户都安弹性模式
- 微服务安全模式
- 微服务日志记录和跟踪模式
- 微服务构建和部署模式

### 1.9.1 核心微服务模式

核心微服务开发模式解决了构建微服务的基础问题。基本服务设计的主题如下：

- **服务粒度**：使微服务具有适当程度的职责
- **通信协议**：XML、JSON、Thrift
- **接口设计**：如何设计实际的服务接口
- **服务的配置管理**：如何管理微服务的配置，以便在不同云环境之间移动时，不必更改核心应用程序代码或配置
- **服务之间的事件处理**：如何使用事件解耦微服务，以便最小化服务之间的硬编码依赖关系

### 1.9.2 微服务路由模式

微服务路由模式模式负责处理希望消费微服务的客户端应用程序，使客户端应用程序发现服务的位置并路由到服务。
- **服务发现**：使微服务变得可被发现。
- **服务路由**：为所有服务提供单个入口点。

### 1.9.3 微服务客户端弹性模式

微服务架构是高度分布式的，所以必须对如何防止单个服务（实例）中的问题级联暴露给服务的消费者十分敏感。常见4种客户端弹性模式如下：

- **客户端负载均衡**：在服务客户端上缓存服务实例的位置，以便对微服务的多个实例的调用负载均衡到该微服务的所有健康实例。
- **断路器模式**：如何阻止客户继续调用出现故障的或遭性能问题的服务。
- **后备模式**：服务调用失败时，如何提供后备机制，允许调用微服务之外的其他方法来执行工作。
- **舱壁模式**：微服务应用程序使用多个分布式资源来执行工作。如何区分这些调用，以便表现不佳的服务调用不会对应用程序的其他部分产生负面影响。

### 1.9.4 微服务安全模式

安全模式的基本主题如下：

- **验证**：确定服务的客户都安就是其声称的主体。
- **授权**：确定调用微服务的客户端十分允许执行其正在进行的操作。
- **凭证管理和传播**：避免客户端每次都要提供凭据信息才能访问事务中涉及的服务调用。

### 1.9.5 微服务日志记录和跟踪模式

3种核心日志记录和跟踪模式如下：

- **日志关联**：一个用户事务会调用多个服务，如何将这些服务所生成的日志关联到一起？
- **日志聚合**：将微服务（及其实例）生成的所有日志合并到一个可查询的数据库中。
- **微服务跟踪**：可视化客户端事务的流程，并了解事务所涉及的服务的性能特征。

### 1.9.6 微服务构建和部署模式

构建和部署的主题：

- **构建和部署管道**：如何创建一个可重复的构建和部署过程，一键部署至任何环境。
- **基础设施即代码**：如何将基础设施作为源代码管理下执行和管理的代码去对待？
- **不可变服务器**：确保微服务镜像部署之后永远不会更改。
- **凤凰服务器**：确保运行微服务的服务器定期被拆卸，并重新创建一个不可变的镜像。

## 1.10 使用Spring Cloud构建微服务

将前述模式映射到实现它们的主流Spring Cloud项目：

**开发模式**：

核心微服务模式（Spring Boot）
配置管理（Spring Cloud Config）
异步消息处理（Spring Cloud Stream）

**路由模式**：

服务发现模式（Spring Cloud/Netflix Eureka）
服务路由模式（Spring Cloud/Netflix Zuul）

**客户端弹性模式**：

客户端负载均衡（Spring Cloud/Netflix Ribbon）
断路器模式（Spring Cloud/Netflix Hystrix）
后备模式（Spring Cloud/Netflix Hystrix）
舱壁模式（Spring Cloud/Netflix Hystrix）

**构建部署模式**：

持续集成（Travis CI）
基础设施及代码（Docker）
不可变服务器（Docker）
凤凰服务器（Travis CI/Docker）

**日志记录模式**：

日志关联（Spring Cloud Sleuth）
日志聚合（Spring Cloud Sleuth与Papertrail）
微服务跟踪（Spring Cloud Sleuth/Zipkin）

**安全模式**：

授权（Spring Cloud Security/OAuth 2）
验证（Spring Cloud Security/OAuth 2）
凭据管理与传播（Spring Cloud Security/OAuth 2/JWT）